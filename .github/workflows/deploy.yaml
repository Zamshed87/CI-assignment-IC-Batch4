name: CD - Deploy After Successful Build

on:
  workflow_run:
    workflows: ["CI - Build, Scan, Test, Lint"]
    types:
      - completed

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service: [api, worker]

    steps:
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: ${{ matrix.service }}-artifact
          path: ./${{ matrix.service }}

      - name: Show contents
        run: ls -R ./${{ matrix.service }}

      - name: Simulate deploy
        run: |
          echo "Pretend to deploy ${{ matrix.service }} here"
          echo "This is where you'd push the Docker image or apply Kubernetes manifests"
